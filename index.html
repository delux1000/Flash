<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RPC Transfer Guide</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 40px auto;
            padding: 20px;
            background: #f5f7fa;
            color: #333;
        }
        h1, h2 {
            color: #2c3e50;
        }
        .card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .info {
            background: #e3f2fd;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            word-break: break-all;
        }
        input, button {
            padding: 10px;
            margin: 5px 0;
            width: 100%;
            box-sizing: border-box;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        button {
            background: #3b99fc;
            color: white;
            font-weight: bold;
            cursor: pointer;
            border: none;
        }
        button:hover {
            background: #2a7ac4;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .balance {
            font-size: 1.2em;
            margin: 10px 0;
        }
        .error {
            color: #c62828;
            background: #ffebee;
            padding: 10px;
            border-radius: 5px;
        }
        .success {
            color: #2e7d32;
            background: #e8f5e9;
            padding: 10px;
            border-radius: 5px;
        }
        .step {
            background: #fff3e0;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
    </style>
    <!-- Ethers.js -->
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
</head>
<body>
    <h1>ðŸš€ RPC Transfer Guide</h1>
    <p>Use this page to send ETH or USDT on your custom RPC network.</p>

    <div class="card">
        <h2>ðŸ“¡ Network Details</h2>
        <div class="info">
            <strong>RPC URL:</strong> https://express-shipping-mcu1.onrender.com<br>
            <strong>Chain ID:</strong> 1<br>
            <strong>Symbol:</strong> ETH<br>
            <strong>USDT Contract:</strong> 0xdac17f958d2ee523a2206206994597c13d831ec7
        </div>
        <p><em>Make sure your wallet is connected to this network. If not, follow the steps below.</em></p>
    </div>

    <div class="card">
        <h2>ðŸ”Œ Connect Wallet</h2>
        <button id="connectBtn">Connect MetaMask / Wallet</button>
        <div id="accountInfo" class="info" style="display:none;"></div>
        <div id="balanceInfo" class="balance" style="display:none;"></div>
    </div>

    <div class="card" id="sendEthCard" style="display:none;">
        <h2>ðŸ’° Send ETH</h2>
        <input type="text" id="ethTo" placeholder="Recipient address (0x...)" />
        <input type="text" id="ethAmount" placeholder="Amount in ETH (e.g., 0.01)" />
        <button id="sendEthBtn">Send ETH</button>
        <div id="ethResult"></div>
    </div>

    <div class="card" id="sendUsdtCard" style="display:none;">
        <h2>ðŸ’µ Send USDT</h2>
        <input type="text" id="usdtTo" placeholder="Recipient address (0x...)" />
        <input type="text" id="usdtAmount" placeholder="Amount in USDT (e.g., 200)" />
        <button id="sendUsdtBtn">Send USDT</button>
        <div id="usdtResult"></div>
    </div>

    <div class="card">
        <h2>ðŸ“‹ Manual Setup Guide</h2>
        <div class="step">
            <strong>Step 1:</strong> Add the custom network to your wallet<br>
            <code>Network Name: Custom RPC<br>
            RPC URL: https://express-shipping-mcu1.onrender.com<br>
            Chain ID: 1<br>
            Symbol: ETH</code>
        </div>
        <div class="step">
            <strong>Step 2:</strong> Import the USDT token (optional)<br>
            <code>Contract Address: 0xdac17f958d2ee523a2206206994597c13d831ec7<br>
            Symbol: USDT<br>
            Decimals: 6</code>
        </div>
        <div class="step">
            <strong>Step 3:</strong> Use the "Connect Wallet" button above and then send transactions.
        </div>
        <div class="step">
            <strong>Alternative â€“ curl commands:</strong><br>
            <strong>Send ETH:</strong><br>
            <code>curl -X POST https://express-shipping-mcu1.onrender.com -H "Content-Type: application/json" -d '{"jsonrpc":"2.0","method":"eth_sendTransaction","params":[{"from":"YOUR_ADDRESS","to":"RECIPIENT","value":"0xde0b6b3a7640000"}],"id":1}'</code><br>
            <strong>Send USDT:</strong><br>
            <code>curl -X POST https://express-shipping-mcu1.onrender.com -H "Content-Type: application/json" -d '{"jsonrpc":"2.0","method":"eth_sendTransaction","params":[{"from":"YOUR_ADDRESS","to":"0xdac17f958d2ee523a2206206994597c13d831ec7","data":"0xa9059cbb000000000000000000000000RECIPIENT_ADDRESS_PADDED_32_BYTES000000000000000000000000000000000000000000000000000000000bebc200"}],"id":1}'</code>
        </div>
    </div>

    <script>
        const RPC_URL = "https://express-shipping-mcu1.onrender.com";
        const USDT_ADDRESS = "0xdac17f958d2ee523a2206206994597c13d831ec7";
        const CHAIN_ID = 1; // hex 0x1

        let provider, signer, userAddress;

        document.getElementById('connectBtn').addEventListener('click', connectWallet);

        async function connectWallet() {
            if (typeof window.ethereum === 'undefined') {
                alert('No wallet detected. Please install MetaMask or another Web3 wallet.');
                return;
            }

            try {
                // Request account access
                await window.ethereum.request({ method: 'eth_requestAccounts' });

                // Create ethers provider using the injected provider
                provider = new ethers.providers.Web3Provider(window.ethereum);
                signer = provider.getSigner();
                userAddress = await signer.getAddress();

                // Check network and prompt to switch if needed
                const network = await provider.getNetwork();
                if (network.chainId !== CHAIN_ID) {
                    try {
                        await window.ethereum.request({
                            method: 'wallet_switchEthereumChain',
                            params: [{ chainId: '0x1' }] // 0x1 is hex for 1
                        });
                    } catch (switchError) {
                        if (switchError.code === 4902) {
                            await window.ethereum.request({
                                method: 'wallet_addEthereumChain',
                                params: [{
                                    chainId: '0x1',
                                    chainName: 'Custom RPC',
                                    nativeCurrency: { name: 'ETH', symbol: 'ETH', decimals: 18 },
                                    rpcUrls: [RPC_URL]
                                }]
                            });
                        } else {
                            throw switchError;
                        }
                    }
                }

                document.getElementById('accountInfo').style.display = 'block';
                document.getElementById('accountInfo').innerText = `Connected: ${userAddress}`;
                document.getElementById('sendEthCard').style.display = 'block';
                document.getElementById('sendUsdtCard').style.display = 'block';
                document.getElementById('connectBtn').disabled = true;

                // Update balances
                await updateBalances();

                // Listen for account/chain changes
                window.ethereum.on('accountsChanged', (accounts) => {
                    if (accounts.length === 0) {
                        window.location.reload();
                    } else {
                        userAddress = accounts[0];
                        document.getElementById('accountInfo').innerText = `Connected: ${userAddress}`;
                        updateBalances();
                    }
                });
                window.ethereum.on('chainChanged', () => window.location.reload());

            } catch (error) {
                console.error(error);
                alert('Connection failed: ' + error.message);
            }
        }

        async function updateBalances() {
            if (!provider || !userAddress) return;
            try {
                // ETH balance
                const ethBalance = await provider.getBalance(userAddress);
                document.getElementById('balanceInfo').style.display = 'block';
                document.getElementById('balanceInfo').innerHTML = `
                    <strong>ETH Balance:</strong> ${ethers.utils.formatEther(ethBalance)} ETH<br>
                `;

                // USDT balance
                const usdtContract = new ethers.Contract(USDT_ADDRESS, [
                    "function balanceOf(address) view returns (uint256)",
                    "function decimals() view returns (uint8)",
                    "function symbol() view returns (string)"
                ], provider);
                const usdtBalance = await usdtContract.balanceOf(userAddress);
                const decimals = await usdtContract.decimals();
                const symbol = await usdtContract.symbol();
                const formatted = ethers.utils.formatUnits(usdtBalance, decimals);
                document.getElementById('balanceInfo').innerHTML += `
                    <strong>${symbol} Balance:</strong> ${parseFloat(formatted).toLocaleString()} ${symbol}
                `;
            } catch (e) {
                console.error('Balance update error:', e);
            }
        }

        // Send ETH
        document.getElementById('sendEthBtn').addEventListener('click', async () => {
            const to = document.getElementById('ethTo').value.trim();
            const amount = document.getElementById('ethAmount').value.trim();
            const resultDiv = document.getElementById('ethResult');

            if (!to || !amount) {
                resultDiv.innerHTML = '<span class="error">Please fill both fields</span>';
                return;
            }
            if (!ethers.utils.isAddress(to)) {
                resultDiv.innerHTML = '<span class="error">Invalid address</span>';
                return;
            }

            try {
                resultDiv.innerHTML = '<span>Sending...</span>';
                const tx = await signer.sendTransaction({
                    to: to,
                    value: ethers.utils.parseEther(amount)
                });
                resultDiv.innerHTML = `<span class="success">Transaction sent! Hash: ${tx.hash}</span>`;
                await tx.wait();
                resultDiv.innerHTML += `<br><span class="success">Confirmed!</span>`;
                await updateBalances();
            } catch (err) {
                resultDiv.innerHTML = `<span class="error">Error: ${err.message}</span>`;
            }
        });

        // Send USDT
        document.getElementById('sendUsdtBtn').addEventListener('click', async () => {
            const to = document.getElementById('usdtTo').value.trim();
            const amount = document.getElementById('usdtAmount').value.trim();
            const resultDiv = document.getElementById('usdtResult');

            if (!to || !amount) {
                resultDiv.innerHTML = '<span class="error">Please fill both fields</span>';
                return;
            }
            if (!ethers.utils.isAddress(to)) {
                resultDiv.innerHTML = '<span class="error">Invalid address</span>';
                return;
            }

            try {
                resultDiv.innerHTML = '<span>Sending...</span>';
                const usdtContract = new ethers.Contract(USDT_ADDRESS, [
                    "function transfer(address to, uint256 amount) returns (bool)",
                    "function decimals() view returns (uint8)"
                ], signer);

                const decimals = 6; // USDT has 6 decimals
                const amountParsed = ethers.utils.parseUnits(amount, decimals);

                const tx = await usdtContract.transfer(to, amountParsed);
                resultDiv.innerHTML = `<span class="success">Transaction sent! Hash: ${tx.hash}</span>`;
                await tx.wait();
                resultDiv.innerHTML += `<br><span class="success">Confirmed!</span>`;
                await updateBalances();
            } catch (err) {
                resultDiv.innerHTML = `<span class="error">Error: ${err.message}</span>`;
            }
        });
    </script>
</body>
</html>
